<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Username â€¢ Something</title>
    <link rel="stylesheet" href="/fullProfile.css">
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu+Mono&display=swap" rel="stylesheet">
</head>
<body>
    <div id="nav">
        <div id="playerSearch">
            <input type="text" id="searchInput" placeholder="enter a username to view their profile...">
        </div>
    </div>
    
    <!-- User Not Found Error Screen -->
    <div id="userNotFoundScreen" style="display: none; text-align: center; padding: 100px 20px; background-color: #f0e8ca; min-height: 100vh;">
        <div style="font-size: 64px; margin-bottom: 30px; color: #2c3e50;">ðŸ¤”</div>
        <h1 style="color: #2c3e50; font-size: 32px; margin-bottom: 15px; font-family: 'Ubuntu Mono', monospace; text-transform: uppercase;">No such user!</h1>
        <p style="color: #7f8c8d; font-size: 18px; font-family: 'Ubuntu Mono', monospace;">Either you mistyped something, or the account no longer exists.</p>
    </div>
    
    <div id="profile-container">
        <div id="center-wrapper">

            <div id="main-content">
                <!-- LEFT COLUMN -->
                <div id="left-column">
                    <div id="username"></div>
                    <div id="creationDate"></div>
                    <div id="pfp">
                        <img id="profile-picture" alt="profile picture">
                    </div>
                </div>

                <!-- RIGHT COLUMN -->
                <div id="right-column">
                    <!-- CENTER COLUMN for summary stats -->
                    <div id="summary-stats">
                        <div class="stat">
                            <div class="stat-label">time typing</div>
                            <div id="timeTyping" class="stat-value">--:--:--</div>
                        </div>
                        <div class="divider"></div>
                        <div class="stat">
                            <div class="stat-label">tests completed</div>
                            <div id="practiceTestsCompleted" class="stat-value"">--</div>
                        </div>
                        <div class="divider"></div>
                        <div class="stat">
                            <div class="stat-label">pvp matches won</div>
                            <div class="stat-value" id="pvpWins">--</div>
                        </div>
                    </div>

                    <!-- ABOUT ME SECTION -->
                    <div id="aboutme">
                        <div class="section-header">â˜… ABOUT ME</div>
                        <div class="about-content"></div>
                    </div>
                </div>
            </div>

            <!-- BOTTOM CONTENT -->
            <div id="bottom-content">
                <div class="wpm-grid">
                    <div class="wpm-square">
                        <div class="wpm-label">5 Words</div>
                        <div class="wpm-value" id="best5WordWpm">--</div>
                    </div>
                    <div class="wpm-square">
                        <div class="wpm-label">10 Words</div>
                        <div class="wpm-value" id="best10WordWpm">--</div>
                    </div>
                    <div class="wpm-square">
                        <div class="wpm-label">25 Words</div>
                        <div class="wpm-value" id="best25WordWpm">--</div>
                    </div>
                    <div class="wpm-square">
                        <div class="wpm-label">50 Words</div>
                        <div class="wpm-value" id="best50WordWpm">--</div>
                    </div>
                    <div class="wpm-square">
                        <div class="wpm-label">PvP</div>
                        <div class="wpm-value" id="bestPvpWpm">--</div>
                    </div>
                </div>
                <div id="news">
                    <div class="section-header">ðŸ“‹ LATEST NEWS</div>
                    <div class="stats-content"></div>
                </div>
            </div>
        </div>
    </div>

    <script>

        function formatTime(totalSeconds) {
            let hours = Math.floor(totalSeconds / 3600);
            let minutes = Math.floor((totalSeconds % 3600) / 60);
            let seconds = totalSeconds % 60;
                            // Add leading zeros
            hours = hours.toString().padStart(2, '0');
            minutes = minutes.toString().padStart(2, '0');
            seconds = seconds.toString().padStart(2, '0');                
            return `${hours}:${minutes}:${seconds}`;
        }

        // Get username from URL parameter
        const usernameFromUrl = window.location.pathname.split('/').pop();
        
        fetch(`/api/userprofile/${usernameFromUrl}`)
        .then(response => {
            if (!response.ok) {
                if (response.status === 404) {
                    throw new Error('User not found');
                } else {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
            }
            return response.json();
        })
        .then(data => {
            console.log('Profile data received:', data);
            // Update page title with username from URL
            document.title = `${usernameFromUrl} â€¢ Typing Game`;
            document.getElementById('username').textContent = data.username;
            console.log('Setting profile picture to:', data.profilePicture);
            document.getElementById('profile-picture').src = `/proxy-image?url=${encodeURIComponent(data.profilePicture)}`;
            document.getElementById('creationDate').textContent = `JOINED ${new Date(data.creationDate).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}`.toUpperCase();
            document.getElementById('timeTyping').textContent = formatTime(data.totalTypingTime || 0);
            document.getElementById('practiceTestsCompleted').textContent = data.practiceTestsCompleted || '-';
            document.getElementById('pvpWins').textContent = data.pvpWins || '-';
            
            // Update best WPM values
            document.getElementById('best5WordWpm').textContent = data.best5WordWpm || '--';
            document.getElementById('best10WordWpm').textContent = data.best10WordWpm || '--';
            document.getElementById('best25WordWpm').textContent = data.best25WordWpm || '--';
            document.getElementById('best50WordWpm').textContent = data.best50WordWpm || '--';
            document.getElementById('bestPvpWpm').textContent = data.bestPvpWpm || '--';
            
            // Show content after everything is loaded
            document.body.classList.add('loaded');
        })
        .catch(error => {
            console.error('Error loading profile:', error);
            
            // Hide the profile container
            document.getElementById('profile-container').style.display = 'none';
            
            // Show the error screen
            document.getElementById('userNotFoundScreen').style.display = 'block';
            
            document.body.classList.add('loaded');
        });
    </script>
    <script src="/script.js"></script>
</body>
</html>